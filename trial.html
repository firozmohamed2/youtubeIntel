<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link href="https://fonts.googleapis.com/css2?family=League+Spartan:wght@700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" rel="stylesheet" type="text/css" />
  <link href="https://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic,700italic" rel="stylesheet" type="text/css" />
  <!-- FontAweome CDN Link for Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
  <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-auth.js"></script>
    <title>Mobile First YouTube Video Player</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            background: #ededf8;
        }

        .heading {
            font-family: 'League Spartan', sans-serif;
            font-weight: 700;
            margin: 20px 0;
            color: #fff;
            align-items: left;
        }

        .video-container {
            width: 100%;
            padding: 10px;
            box-sizing: border-box;
            background: #fff;
        }

        .video-container iframe {
            width: 100%;
            aspect-ratio: 16 / 9; /* This will maintain a 16:9 aspect ratio */
        }

        .controls, .options {
            display: flex;
            justify-content: center;
            margin: 10px 0;
            width: 100%;
        }

        .controls {
            display: none; /* Hide controls initially */
            background: #ffffff;
        }


        .controls button, .options button {
            margin: 0 5px;
            font-size: 15px;
            border: none;
            border-radius: 5px;
            background-color: #ffffff;
            color: rgb(0, 0, 0);
            cursor: pointer;
            transition: transform 0.5s;
        }

        .options button {
            margin: 0 20px;
            padding: 8px 12px;
            border-radius: 7px;
        }

        .controls button:hover, .options button:hover {
            background-color: #e6e0e0;
        }

        .choices{
            display: flex;
            justify-content: center;
            margin: 10px 0;
            width: 100%;

            
            
        }


        .choices button{
            margin: 0 5px;
            font-size: 16px;
            border: none;
            border-radius: 5px;
            background-color: #ffffff;
            color: rgb(0, 0, 0);
            cursor: pointer;
            transition: transform 0.5s;
            margin: 0 20px;
            padding: 7px 20px;

        }
        .pause{
            width: 25px;
           
            
        }
        #clear_button{
            color: #47C450;
        }
        #not_clear_button{
            color: #7990DB;
        }
    </style>
</head>
<body>
    <h1 class="heading">INTEL CLASS</h1>
    <div class="video-container" id="video_container">
      <!-- <div >
          <iframe id="videoPlayer" src="https://www.youtube.com/embed/XrYzXwnq7Fc" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
      </div> -->
    </div>
    <div class="controls" id="controls">
        <button id="backward"><img src="backward.png"></button>
        <button id="pause"><img id="pause_img" src="play.png" style="width: 25px;"></button>
        <button id="forward"><img src="forward.png"></button>
    </div>
    <div class="options">
        <button class="option" id="A">A</button>
        <button class="option" id="B">B</button>
        <button class="option" id="C">C</button>
        <button class="option" id="D">D</button>
    </div>

    <div class="choices">
        <button class="option" id="clear_button">Clear</button>
        <button class="option" id="not_clear_button">Not Clear</button>
    </div>

    <!-- Core theme JS-->
  <!-- <script src="scripts.js"></script> -->
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>


    <script>

        var controls = document.getElementById('controls');


        document.getElementById('backward').addEventListener('click', function() {
            this.style.transform = 'rotate(-30deg)';
            setTimeout(() => {
                this.style.transform = 'rotate(0deg)';
            }, 100);
        });

        document.getElementById('forward').addEventListener('click', function() {
            this.style.transform = 'rotate(30deg)';
            setTimeout(() => {
                this.style.transform = 'rotate(0deg)';
            }, 100);
        });


        function getQueryParam(param) {
      var urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(param);
    }




        function initializeVideoPlayer(videoId) {
      var div = document.createElement('div');
      div.innerHTML = '<iframe class="embed-responsive-item" id="video" src="https://www.youtube.com/embed/' + videoId + '?enablejsapi=1&html5=1&modestbranding=0&controls=0&rel=0&showinfo=0" allowfullscreen></iframe>';
      document.getElementById("video_container").appendChild(div);
    }

    var collection="";
    document.addEventListener('DOMContentLoaded', function() {
      // var videoId = getQueryParam('videoId') || 'XrYzXwnq7Fc';
      var videoId = getQueryParam('videoId') ;
       collection = getQueryParam('collection');
      if(videoId){
        initializeVideoPlayer(videoId);

      }
    }, false);






    // Firebase credentials
const firebaseConfig = {
  apiKey: "AIzaSyA88fPkOvcI4QA9qD3ROpk-ay-V6ibQQlc",
  authDomain: "my-application-7fd40.firebaseapp.com",
  projectId: "my-application-7fd40",
  storageBucket: "my-application-7fd40.appspot.com",
  messagingSenderId: "269589994279",
  appId: "1:269589994279:web:4c617a622c328a1224e702",
  measurementId: "G-D8MD1J28GR",
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);

// Auth state check - login or not
firebase.auth().onAuthStateChanged((user) => {
  if (user) {
    var userId = user.uid;

    if (user.isAnonymous) {
      signInState = 0;
    } else {
      userEmail = user.email;
    }
  } else {
    signInState = 0;
    firebase
      .auth()
      .signInAnonymously()
      .catch(function (error) {
        console.log(error.code, error.message);
      });
  }
});

// Firebase components
var firestore = firebase.firestore();

firebase.auth().onAuthStateChanged((user) => {
  if (user) {
    var userId = user.uid;

    if (user.isAnonymous) {
      signInState = 0;
    } else {
      userEmail = user.email;
    }
  } else {
    signInState = 0;
    firebase
      .auth()
      .signInAnonymously()
      .catch(function (error) {
        console.log(error.code, error.message);
      });
  }
});

// Firebase components
var firestore = firebase.firestore();

// Initial variable declarations
var documentExists = true;
var correctAnswerDocId = "";
var wrongAnswerDocId = "";
var videoEndTime = "";
var hasQuestion = "";
var correctAnswerOption = "";
var showQuestionTime = "100";
var nextPartTime = "";
var videoStartTime = "";
var videoId = "";

// Variables for right answer
var rightAnswerStartTime = "";
var rightAnswerEndTime = "";
var rightAnswerCorrectDocId = "";
var rightAnswerWrongDocId = "";
var rightAnswerHasQuestion = "";
var rightAnswerOption = "";
var rightAnswerShowQuestionTime = "";
var rightAnswerNextPartTime = "";
var rightAnswerVideoId = "";

// Variables for wrong answer
var wrongAnswerStartTime = "";
var wrongAnswerEndTime = "";
var wrongAnswerCorrectDocId = "";
var wrongAnswerWrongDocId = "";
var wrongAnswerHasQuestion = "";
var wrongAnswerOption = "";
var wrongAnswerShowQuestionTime = "";
var wrongAnswerNextPartTime = "";
var wrongAnswerVideoId = "";

// Data from YouTube file
var selectedAnswer = "";
var videoStartTime = "";
var videoEndTime = "";
var player;
var pauseButton = document.getElementById("pause");

// Option buttons
var optionA = document.getElementById("A");
var optionB = document.getElementById("B");
var optionC = document.getElementById("C");
var optionD = document.getElementById("D");


optionA.style.display = "none";
optionB.style.display = "none";
optionC.style.display = "none";
optionD.style.display = "none";

closePopup();


// This function gets called when API is ready to use
function onYouTubePlayerAPIReady() {
  // Create the global player from the specific iframe (#video)
  player = new YT.Player("video", {
    events: {
      // Call this function when player is ready to use
      onReady: onPlayerReady,
      onStateChange: onPlayerStateChange,
    },
  });
}

function onPlayerReady(event) {
  move();

  loadFirebaseData("A1");
//   document.querySelector('.controls').style.display = 'flex';


  // Bind events
  optionA.addEventListener("click", function () {
    handleOptionClick("a");
  });
  optionB.addEventListener("click", function () {
    handleOptionClick("b");
  });
  optionC.addEventListener("click", function () {
    handleOptionClick("c");
  });
  optionD.addEventListener("click", function () {
    handleOptionClick("d");
  });

  function handleOptionClick(option) {
    console.log(
      "Right option: " + correctAnswerOption + ", clicked option: " + option
    );
    if (correctAnswerOption === option) {
      console.log("Right answer");
      videoEndTime = rightAnswerEndTime;
      videoStartTime = rightAnswerStartTime;
      correctAnswerDocId = rightAnswerCorrectDocId;
      wrongAnswerDocId = rightAnswerWrongDocId;
      hasQuestion = rightAnswerHasQuestion;
      correctAnswerOption = rightAnswerOption;
      showQuestionTime = rightAnswerShowQuestionTime;
      nextPartTime = rightAnswerNextPartTime;
      videoStartTime = rightAnswerStartTime;
      videoId = rightAnswerVideoId;

      loadFirebaseDataForCorrectAnswer(correctAnswerDocId);

      if (wrongAnswerDocId !== "") {
        loadFirebaseDataForWrongAnswer(wrongAnswerDocId);
      }
      player.playVideo();
    } else {
      console.log("Wrong answer");
      videoEndTime = wrongAnswerEndTime;
      videoStartTime = wrongAnswerStartTime;
      correctAnswerDocId = wrongAnswerCorrectDocId;
      wrongAnswerDocId = wrongAnswerWrongDocId;
      hasQuestion = wrongAnswerHasQuestion;
      correctAnswerOption = wrongAnswerOption;
      showQuestionTime = wrongAnswerShowQuestionTime;
      nextPartTime = wrongAnswerNextPartTime;
      videoStartTime = wrongAnswerStartTime;
      videoId = wrongAnswerVideoId;

      loadFirebaseDataForCorrectAnswer(correctAnswerDocId);

      if (wrongAnswerDocId !== "") {
        loadFirebaseDataForWrongAnswer(wrongAnswerDocId);
      }

      player.playVideo();
    }
    optionA.style.display = "none";
    optionB.style.display = "none";
    optionC.style.display = "none";
    optionD.style.display = "none";

    closePopup();
    if (documentExists) {
      player.seekTo(videoStartTime);
      player.playVideo();
    }
  }

  var rewindButton = document.getElementById("backward");
  rewindButton.addEventListener("click", function () {
    if (player.playerInfo.currentTime - 10 < videoStartTime) {
      player.seekTo(videoStartTime);
    } else {
      player.seekTo(player.playerInfo.currentTime - 10);
    }
  });

  var fastForwardButton = document.getElementById("forward");
  fastForwardButton.addEventListener("click", function () {
    if (player.playerInfo.currentTime + 10 > videoEndTime) {
      player.seekTo(videoEndTime);
      player.pauseVideo();
    } else {
      player.seekTo(player.playerInfo.currentTime + 10);
    }
  });
}

// Inject YouTube API script
var tag = document.createElement("script");
tag.src = "https://www.youtube.com/player_api";
var firstScriptTag = document.getElementsByTagName("script")[0];
firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

function move() {
  var currentTime = player.playerInfo.currentTime;

  if (currentTime < videoStartTime || currentTime > videoEndTime) {
    player.pauseVideo();
  }

  if (showQuestionTime !== "") {
    if (currentTime >= showQuestionTime) {
      optionA.style.display = "inline-block";
      optionB.style.display = "inline-block";
      optionC.style.display = "inline-block";
      optionD.style.display = "inline-block";
      openPopup();
    }
  }

  if (nextPartTime !== "") {
    if (currentTime >= nextPartTime) {
      optionA.style.display = "none";
      optionB.style.display = "none";
      optionC.style.display = "none";
      optionD.style.display = "none";
      closePopup();

      videoEndTime = rightAnswerEndTime;
      videoStartTime = rightAnswerStartTime;
      correctAnswerDocId = rightAnswerCorrectDocId;
      wrongAnswerDocId = rightAnswerWrongDocId;
      hasQuestion = rightAnswerHasQuestion;
      correctAnswerOption = rightAnswerOption;
      showQuestionTime = rightAnswerShowQuestionTime;
      nextPartTime = rightAnswerNextPartTime;
      videoStartTime = rightAnswerStartTime;
      videoId = rightAnswerVideoId;

      loadFirebaseDataForCorrectAnswer(correctAnswerDocId);

      if (wrongAnswerDocId !== "") {
        loadFirebaseDataForWrongAnswer(wrongAnswerDocId);
      }

      if (documentExists) {
        player.seekTo(videoStartTime);
        player.playVideo();
      }
    }
  }

  setTimeout(move, 1000);
}


    var pauseButtonImage = document.getElementById("pause_img");

    // Handle player state changes
    function onPlayerStateChange(event) {
        if (event.data === YT.PlayerState.PLAYING) {
            pauseButtonImage.src = "pause1.png";
            document.querySelector('.controls').style.display = 'flex'; // Show controls when playing
        } else if (event.data === YT.PlayerState.PAUSED) {
            pauseButtonImage.src = "play.png";
        }
    }

   // Initial button setup for toggling play/pause
    pauseButton.onclick = function () {
        if (player.getPlayerState() === YT.PlayerState.PLAYING) {
          pauseButtonImage.src = "play.png";
          player.pauseVideo();

        } else {
          pauseButtonImage.src = "pause1.png";
          player.playVideo();


        }
    };



    

function stopVideo() {
  player.stopVideo();
}

// Load Firebase data for the main document
function loadFirebaseData(docId) {
  console.log("Document loaded with id = " + docId);

  var docRef = firestore.collection(collection).doc(docId);
  docRef.get().then(function (doc) {
    if (doc && doc.exists) {
      var data = doc.data();

      hasQuestion = data.hq;
      correctAnswerDocId = data.Ir;
      videoEndTime = data.et;
      videoStartTime = data.st;
      videoStartTime = videoStartTime;
      videoEndTime = videoEndTime;

      if (hasQuestion === "yes") {
        showQuestionTime = data.sqt;
        wrongAnswerDocId = data.Iw;
        correctAnswerOption = data.rao;

        loadFirebaseDataForCorrectAnswer(correctAnswerDocId);
        loadFirebaseDataForWrongAnswer(wrongAnswerDocId);
        nextPartTime = "";
      } else {
        nextPartTime = data.snt;
        showQuestionTime = "";
        wrongAnswerDocId = "";
        correctAnswerOption = "";
        loadFirebaseDataForCorrectAnswer(correctAnswerDocId);
      }
    } else {
      documentExists = false;
    }
  });
}

// Load Firebase data for the correct answer path
function loadFirebaseDataForCorrectAnswer(docId) {
  console.log("Correct answer document loaded with id = " + docId);

  rightAnswerStartTime = "";
  rightAnswerEndTime = "";
  rightAnswerNextPartTime = "";
  rightAnswerShowQuestionTime = "";

  var docRef = firestore.collection(collection).doc(docId);
  docRef.get().then(function (doc) {
    if (doc && doc.exists) {
      var data = doc.data();

      rightAnswerEndTime = data.et;
      rightAnswerStartTime = data.st;
      rightAnswerHasQuestion = data.hq;
      rightAnswerCorrectDocId = data.Ir;
      rightAnswerVideoStartTime = rightAnswerStartTime;
      rightAnswerVideoEndTime = rightAnswerEndTime;

      if (rightAnswerHasQuestion === "yes") {
        rightAnswerShowQuestionTime = data.sqt;
        rightAnswerWrongDocId = data.Iw;
        rightAnswerOption = data.rao;

        rightAnswerNextPartTime = "";
      } else {
        rightAnswerNextPartTime = data.snt;
        rightAnswerShowQuestionTime = "";
        rightAnswerWrongDocId = "";
        rightAnswerOption = "";
      }
    } else {
      documentExists = false;
    }
  });
}

// Load Firebase data for the wrong answer path
function loadFirebaseDataForWrongAnswer(docId) {
  console.log("Wrong answer document loaded with id = " + docId);

  wrongAnswerStartTime = "";
  wrongAnswerEndTime = "";
  wrongAnswerNextPartTime = "";
  wrongAnswerShowQuestionTime = "";

  var docRef = firestore.collection(collection).doc(docId);
  docRef.get().then(function (doc) {
    if (doc && doc.exists) {
      var data = doc.data();

      wrongAnswerEndTime = data.et;
      wrongAnswerStartTime = data.st;
      wrongAnswerHasQuestion = data.hq;
      wrongAnswerCorrectDocId = data.Ir;
      wrongAnswerVideoStartTime = wrongAnswerStartTime;
      wrongAnswerVideoEndTime = wrongAnswerEndTime;

      if (wrongAnswerHasQuestion === "yes") {
        wrongAnswerShowQuestionTime = data.sqt;
        wrongAnswerWrongDocId = data.Iw;
        wrongAnswerOption = data.rao;

        loadFirebaseDataForCorrectAnswer(wrongAnswerCorrectDocId);
        loadFirebaseDataForWrongAnswer(wrongAnswerWrongDocId);
        wrongAnswerNextPartTime = "";
      } else {
        wrongAnswerNextPartTime = data.snt;
        wrongAnswerShowQuestionTime = "";
        wrongAnswerWrongDocId = "";
        wrongAnswerOption = "";
      }
    } else {
      documentExists = false;
    }
  });
}

function openPopup() {
  document.getElementsByClassName("options")[0].classList.add("active");
}

function closePopup() {
  document.getElementsByClassName("options")[0].classList.remove("active");
}


document.getElementById('clear_button').addEventListener('click', function() {
           console.log("hi");
           player.playVideo();
        });


    </script>
</body>
</html>
